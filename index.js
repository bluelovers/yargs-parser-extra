"use strict";
/**
 * Created by user on 2020/1/19.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const yargs_parser_1 = require("yargs-parser");
const lodash_defaultsdeep_1 = __importDefault(require("lodash.defaultsdeep"));
exports.SymInputArgs = Symbol.for('InputArgs');
function handleOptions(options) {
    return lodash_defaultsdeep_1.default({}, options, {
        configuration: {
            'populate--': true,
        },
    });
}
exports.handleOptions = handleOptions;
function detailed(input, options) {
    options = handleOptions(options);
    if (options.filter) {
        input = input.filter(options.filter);
    }
    if (options.map) {
        input = input.slice().map(options.map);
    }
    let data = yargs_parser_1.detailed(input, options);
    let { argv } = data;
    argv = {
        _: argv._,
        __: argv['--'],
        ...argv,
        [exports.SymInputArgs]: Object.freeze(input.slice()),
    };
    Object.defineProperty(argv, '__', {
        get() {
            return this['--'];
        },
    });
    data.argv = argv;
    return data;
}
exports.detailed = detailed;
function parseArgv(input, options) {
    return detailed(input, options).argv;
}
exports.parseArgv = parseArgv;
exports.default = parseArgv;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7Ozs7O0FBR0gsK0NBQXVHO0FBQ3ZHLDhFQUErQztBQUVsQyxRQUFBLFlBQVksR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBbUJwRCxTQUFnQixhQUFhLENBQUMsT0FBaUI7SUFFOUMsT0FBTyw2QkFBWSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUU7UUFDaEMsYUFBYSxFQUFFO1lBQ2QsWUFBWSxFQUFFLElBQUk7U0FDbEI7S0FDRCxDQUFDLENBQUE7QUFDSCxDQUFDO0FBUEQsc0NBT0M7QUFFRCxTQUFnQixRQUFRLENBQWlFLEtBQVEsRUFBRSxPQUFpQjtJQUVuSCxPQUFPLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBRWhDLElBQUksT0FBTyxDQUFDLE1BQU0sRUFDbEI7UUFDQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFRLENBQUE7S0FDM0M7SUFFRCxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQ2Y7UUFDQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFRLENBQUE7S0FDN0M7SUFFRCxJQUFJLElBQUksR0FBRyx1QkFBUyxDQUFDLEtBQWlCLEVBQUUsT0FBTyxDQUFtQyxDQUFDO0lBRW5GLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7SUFFcEIsSUFBSSxHQUFHO1FBQ04sQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ1QsRUFBRSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDZCxHQUFHLElBQUk7UUFDUCxDQUFDLG9CQUFZLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBTTtLQUNqRCxDQUFDO0lBRUYsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFO1FBQ2pDLEdBQUc7WUFFRixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNsQixDQUFDO0tBQ0QsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFFakIsT0FBTyxJQUFJLENBQUE7QUFDWixDQUFDO0FBbkNELDRCQW1DQztBQUVELFNBQWdCLFNBQVMsQ0FBaUUsS0FBUSxFQUFFLE9BQWlCO0lBRXBILE9BQU8sUUFBUSxDQUFPLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUE7QUFDM0MsQ0FBQztBQUhELDhCQUdDO0FBRUQsa0JBQWUsU0FBUyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAyMC8xLzE5LlxuICovXG5cbmltcG9ydCB7IE9wdGlvbnMgYXMgX09wdGlvbnMsIEFyZ3VtZW50cyBhcyBfQXJndW1lbnRzIH0gZnJvbSAneWFyZ3MtcGFyc2VyJztcbmltcG9ydCBfUGFyc2VyLCB7IGRldGFpbGVkIGFzIF9kZXRhaWxlZCwgRGV0YWlsZWRBcmd1bWVudHMgYXMgX0RldGFpbGVkQXJndW1lbnRzIH0gZnJvbSAneWFyZ3MtcGFyc2VyJztcbmltcG9ydCBkZWZhdWx0c0RlZXAgZnJvbSAnbG9kYXNoLmRlZmF1bHRzZGVlcCc7XG5cbmV4cG9ydCBjb25zdCBTeW1JbnB1dEFyZ3MgPSBTeW1ib2wuZm9yKCdJbnB1dEFyZ3MnKTtcbnR5cGUgSW5wdXRBcmcgPSBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuO1xuZXhwb3J0IHR5cGUgSW5wdXRBcmdzID0gSW5wdXRBcmdbXTtcblxuZXhwb3J0IHR5cGUgT3B0aW9ucyA9IF9PcHRpb25zICYge1xuXHRmaWx0ZXI/KGFyZzogSW5wdXRBcmcsIGluZGV4OiBudW1iZXIsIGlucHV0OiBJbnB1dEFyZ3MpOiBib29sZWFuLFxuXHRtYXA/KGFyZzogSW5wdXRBcmcsIGluZGV4OiBudW1iZXIsIGlucHV0OiBJbnB1dEFyZ3MpOiBzdHJpbmcsXG59XG5cbmV4cG9ydCB0eXBlIEFyZ3VtZW50czxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiA9IFJlY29yZDxzdHJpbmcsIGFueT4sIFAgZXh0ZW5kcyBJbnB1dEFyZ3MgPSBJbnB1dEFyZ3M+ID0gX0FyZ3VtZW50cyAmIFQgJiB7XG5cdFtTeW1JbnB1dEFyZ3NdOiBSZWFkb25seTxQPixcblx0Jy0tJz86IHN0cmluZ1tdLFxuXHRfXz86IHN0cmluZ1tdLFxufVxuXG5leHBvcnQgdHlwZSBEZXRhaWxlZEFyZ3VtZW50czxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiA9IFJlY29yZDxzdHJpbmcsIGFueT4sIFAgZXh0ZW5kcyBJbnB1dEFyZ3MgPSBJbnB1dEFyZ3M+ID0gT21pdDxBcmd1bWVudHMsICdhcmd2Jz4gJiB7XG5cdGFyZ3Y6IEFyZ3VtZW50czxULCBQPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZU9wdGlvbnMob3B0aW9ucz86IE9wdGlvbnMpOiBPcHRpb25zXG57XG5cdHJldHVybiBkZWZhdWx0c0RlZXAoe30sIG9wdGlvbnMsIHtcblx0XHRjb25maWd1cmF0aW9uOiB7XG5cdFx0XHQncG9wdWxhdGUtLSc6IHRydWUsXG5cdFx0fSxcblx0fSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRldGFpbGVkPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LCBQIGV4dGVuZHMgSW5wdXRBcmdzID0gSW5wdXRBcmdzPihpbnB1dDogUCwgb3B0aW9ucz86IE9wdGlvbnMpXG57XG5cdG9wdGlvbnMgPSBoYW5kbGVPcHRpb25zKG9wdGlvbnMpXG5cblx0aWYgKG9wdGlvbnMuZmlsdGVyKVxuXHR7XG5cdFx0aW5wdXQgPSBpbnB1dC5maWx0ZXIob3B0aW9ucy5maWx0ZXIpIGFzIGFueVxuXHR9XG5cblx0aWYgKG9wdGlvbnMubWFwKVxuXHR7XG5cdFx0aW5wdXQgPSBpbnB1dC5zbGljZSgpLm1hcChvcHRpb25zLm1hcCkgYXMgYW55XG5cdH1cblxuXHRsZXQgZGF0YSA9IF9kZXRhaWxlZChpbnB1dCBhcyBzdHJpbmdbXSwgb3B0aW9ucykgYXMgYW55IGFzIERldGFpbGVkQXJndW1lbnRzPFQsIFA+O1xuXG5cdGxldCB7IGFyZ3YgfSA9IGRhdGE7XG5cblx0YXJndiA9IHtcblx0XHRfOiBhcmd2Ll8sXG5cdFx0X186IGFyZ3ZbJy0tJ10sXG5cdFx0Li4uYXJndixcblx0XHRbU3ltSW5wdXRBcmdzXTogT2JqZWN0LmZyZWV6ZShpbnB1dC5zbGljZSgpKSBhcyBQLFxuXHR9O1xuXG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcmd2LCAnX18nLCB7XG5cdFx0Z2V0KClcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpc1snLS0nXVxuXHRcdH0sXG5cdH0pO1xuXG5cdGRhdGEuYXJndiA9IGFyZ3Y7XG5cblx0cmV0dXJuIGRhdGFcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJndjxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiwgUCBleHRlbmRzIElucHV0QXJncyA9IElucHV0QXJncz4oaW5wdXQ6IFAsIG9wdGlvbnM/OiBPcHRpb25zKVxue1xuXHRyZXR1cm4gZGV0YWlsZWQ8VCwgUD4oaW5wdXQsIG9wdGlvbnMpLmFyZ3Zcbn1cblxuZXhwb3J0IGRlZmF1bHQgcGFyc2VBcmd2XG4iXX0=